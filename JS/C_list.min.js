jQuery.fn.C_list=function(a){var e,t,n,l,i,r;return r={_this:this,self:jQuery(this),ul:0,page:0},n={all:{length:0},row:[],end:!1},i=function(a){var e,t,n;return t={event:function(){e.event&&e.event(e.modal,e.data,e.index,n)},display:function(){return e.display?!1:(e.modal.html(e.render[0](e.data,n)),e.display=!0,l.async_page.total++,t.event(),void 0)},check:function(){e={__input_params:a,index:a.index,data:a.data,row:a.row,modal:a.modal,width:l.cell.width,height:l.cell.height,render:[l.render],display:!1,event:a.event||l.event}},set_modal:function(){e.modal.css({width:e.width,height:e.height}).attr({func:"c_cell",_index:e.index,_row:e.row})},init:function(){a.data.__c__info?(e=a.data.__c__info(),e.modal=a.modal,e.display=!1):t.check(),t.set_modal()}},n={__c__info:function(){return e},info:function(){return e},update:function(a,n){if(!a)return!1;e.data=a;for(var l in a)e.data[l]=a[l];n||(e.display=!1,t.display())},display:function(){t.display()}},t.init(),n},e={data:{theme:function(a){var e={primary:1,info:1,success:1,warn:1,error:1,inverse:1};return a&&"string"==typeof a&&e[a]||(a=""),a},sort:function(a){var e=[];if(l.sorting)return!1;l.sorting=!0;for(var t=0,i=n.all.length;i>t;t++)e.push(n.all[t].__c__info().data);e=$c.tool.sort(e,a);for(var t=0,i=n.all.length;i>t;t++)n.all[t].update(e[t]);l.sorting=!1},addnew:function(a,t){if(n.end=!1,l.async&&l.page.show){r.ul.empty(),n.row=[];for(var i=0,o=t.length;o>i;i++)n.all[a+i]=t[i];for(var i=0,o=t.length;o>i;i++)r.ul.append(e.ui.get_single_row_modal(i+a));l.total||(l.page.total_page=l.async_page.offset>t.length?(l.async_page.start+l.async_page.offset)/(l.page.page_size*l.row_size):9999)}else{for(var i=0,o=t.length;o>i;i++)n.all[a+i]&&n.all[a+i].update?n.all[a+i].update(t[i]):n.all[a+i]=t[i];for(var i=Math.floor(n.all.length/l.row_size),o=Math.ceil((n.all.length+t.length)/l.row_size)+2;o>i;i++)n.row[i]&&!(n.row[i]<l.row_size)||n.end||r.ul.append(e.ui.get_single_row_modal(i))}for(var i=0,o=t.length;o>i;i++)n.all[a+i]&&n.all[a+i].display&&n.all[a+i].display()},data:function(a,t){var n={start:e.data.row()*l.row_size||0,offset:l.row_size*l.page_size||50,total:l.async_page.total||0,end:!1};return n.start=a||n.start,n.offset=t||n.offset,l.async&&l.page.show&&(n.start=l.page.current*l.page_size*l.row_size),l.async_page=n,l.appending=!0,n},append:function(a,t){var i,o,s=n.all.length;if(i=t?l.async_page.start=n.all.length:l.async_page.start||0,!l.async&&!l.page.load_all){for(var p=0,g=a.length;g>p;p++)n.all[p+l.total]=a[p];return l.total+=g,l.appending=!1,e.data.addnew(i,a)}if(e.data.addnew(l.appending?i:i+s,a),!l.async)return l.appending=!1;for(var p=0,g=a.length;g>p&&(o=i+p,!(o>s&&l.page.load_all));p++)n.all[o]&&(l.data[o]=a[p],n.all[o].display&&n.all[o].display());a.length<l.async_page.offset&&l.appending&&(l.async_page.end=!0),l.page.show&&(l.async_page.end,e.ui.page()),l.callback&&l.callback(a,l),l.appending=!1,l.async&&l.page.show&&!l.page.initialize&&(l.page.initialize=!0,r.ul.height(r.ul.height())),l.page.show&&l.page.wait&&r.ul.removeClass("c_list_loading")},total_rows:function(){return Math.ceil(l.total/l.row_size)},row:function(){return Math.floor(r.self.scrollTop()/l.cell.height)},page_size:function(){var a=r.self.height()||$c.doc.height,e=l.cell.height-0?l.cell.height:l.cell.height.replace(/[p|x]*/g,"");return"string"==typeof e&&-1!==e.indexOf("%")?Math.ceil(1/(e.replace(/\%/,"")/100)):Math.ceil(a/e)},row_size:function(){var a=r.self.width(),e=l.cell.width-0?l.cell.width:l.cell.width.replace(/[p|x]*/g,"");return"string"==typeof e&&-1!==e.indexOf("%")?Math.floor(1/(e.replace(/\%/,"")/100)):Math.floor(a/e)||1},total:function(){var e;if(l.async)return a.total;e=a.total||l.data.length;for(var t=0;e>t;t++)n.all[t]=l.data[t]||{};return e},page:function(a){var e={show:a.show,load_all:a.load_all||!1,page_size:a.page_size||5,buttom_btn_nums:l.total?a.buttom_btn_nums||5:1,current:a.current||0,input:a.input||!1,wait:void 0===a.wait?!0:!1,initialize:!1,number:0};return e.show&&!a.page_size&&(a.page_size=Math.floor((r.self.height()-50)/l.cell.height),e.page_size=a.page_size),e.number=e.page_size*l.row_size,e.total_page=Math.ceil(l.total/(e.page_size*l.row_size))||Math.ceil(l.data.length/(e.page_size*l.row_size)),e.show&&(e.load_all=!0),l.async&&void 0===l.total&&(e.total_page=9999),e},is_async:function(){return a.data?jQuery.isArray(a.data)?!1:"function"==typeof a.data?!0:!1:!1},tag:function(){var e={ul:1,table:1},t={ul:"ul",li:"li",cell:"div"};return a.tag&&e[a.tag]?"ul"==a.tag?t:{ul:"tbody",li:"tr",cell:"td"}:t},check:function(){a=a||{},l={__input_params:$c.tool.rtn(a),theme:"",cell:a.cell||{width:"100%",height:20},render:a.render||!1,event:a.event||!1,data:a.data||[],keepAsk:a.keepAsk||!1,async:e.data.is_async(),replace:void 0===a.replace?!1:a.replace,appending:0,async_page:0,total:0,page:0,tag:e.data.tag(),row_size:0,page_size:0,sorting:0,scroll_time:a.scroll_time||50,callback:a.callback||!1},l.total=e.data.total(),l.row_size=e.data.row_size(),l.page_size=e.data.page_size(),l.page=e.data.page(a.page||{}),l.total=l.async?l.total:l.data.length,l.theme=e.data.theme(a.page&&a.page.theme?a.page.theme:"")}},event:{page:function(){r.page.find("a").unbind("click").click(function(){var a,t,n=jQuery(this),i=n.attr("func");if("off"===i||l.page.wait&&l.appending)return!1;switch(a=n.attr("_index")){case"first":l.page.current=0;break;case"pre":l.page.current=--l.page.current<0?0:l.page.current;break;case"next":l.page.current=++l.page.current>l.page.total_page?l.page.total_page:l.page.current;break;case"last":l.page.current=l.page.total_page-1;break;case"goto":if(t=r.page.find("[func='goto_input']").val(),!jQuery.isNumeric(t)||0>=t)return $c.alert.set("请输入数字！");if(l.page.total_page&&t>l.page.total_page)return $c.alert.set("输入页码超出最大页数！");t--,l.page.current=t>=l.page.total_page?l.page.total_page:t,r.page.find("[func='goto_input']").attr("placeholder",l.page.current+1).val("");break;default:l.page.current=a}l.page.current=parseInt(l.page.current),l.async||e.ui.draw_row(!0),l.async&&l.page.show?(l.page.wait&&r.ul.addClass("c_list_loading"),l.data(e.data.data())):(e.ui.display(),e.ui.page())})},scroll:function(){var a,t=function(){a=window.setTimeout(function(){if(l.async){if(l.async_page.end&&!l.keepAsk)return!1;l.data(e.data.data())}else e.ui.display();r.ul.height()-r.self.scrollTop()<=r.self.height()&&!n.end&&e.ui.append_rows()},l.scroll_time)};return l.page.show?!1:(r.self.scroll(function(){window.clearTimeout(a),t()}),e.ui.show_scroll(),void 0)},init:function(){e.event.scroll()}},ui:{get_single_row_modal:function(a){var e,t,o,s;void 0==n.row[a]||l.page.show?o=jQuery("<"+l.tag.li+" class='c_row' _row='"+a+"' func='c_row' style='height:"+l.cell.height+"px'></"+l.tag.li+">"):(s=!0,o=r.ul.find("[func='c_row'][_row='"+a+"']"));for(var p=0;p<l.row_size;p++)if(e=a*l.row_size+p,!(n.row[a]>p&&s)){if(!n.all[e]&&!l.async){n.end=!0;break}if(l.async&&l.page.load_all&&e>=l.total){n.end=!0;break}if(l.async&&(!n.all[e]||n.all[e]instanceof i)){n.end=!0;break}"100%"===l.cell.width||l.cell.width==r.self.width()?t=o:(t=jQuery("<"+l.tag.cell+" class='c_cell'>"),o.append(t)),n.all[e]=new i({modal:t,index:e,row:a,data:n.all[e]}),n.all.length++}return n.row[a]=p,s?"":o},append_rows:function(){if(l.async&&l.page.load_all)return!1;var a=l.page.current*l.page.page_size;if(a>l.data.length)return!1;for(var t=0,i=l.page.page_size+2;i>t;t++)if(!n.row[a+t]&&!n.end){if(l.total&&(a+t)*l.row_size>=l.total)break;r.ul.append(e.ui.get_single_row_modal(a+t))}l.page.current++,n.row.length<l.page_size&&e.ui.append_rows()},draw_row:function(a){var t,n;if(!a)return e.ui.append_rows();if(l.page.show){n=l.page.current*l.page.page_size;for(var i=0;i<l.page.page_size;i++)r.ul[i?"append":"html"](e.ui.get_single_row_modal(n+i))}else{t=e.data.total_rows();for(var i=0;t>i;i++)r.ul.append(e.ui.get_single_row_modal(i))}},display:function(){var a;if(l.page.show){a=l.page.current*l.page.page_size*l.row_size;for(var t=0,i=l.page.page_size*l.row_size;i>t;t++)n.all[a+t]&&!l.async&&n.all[a+t].display()}else{a=(e.data.row()-1)*l.row_size,a=0>a?0:a;for(var t=0,i=l.row_size*(l.page_size+1);i>t;t++)n.all[a+t]&&n.all[a+t].display&&n.all[a+t].display()}},show_scroll:function(){if(1==l.page.load_all)return!1;for(;r.ul.height()<r.self.height()&&n.all.length&&l.async_page.end;)e.ui.append_rows()},page:function(){if(!l.page.show)return!1;var a=l.page.current,t=(r.page.find("span[func='c_page']"),l.page.total_page-1),n=function(){for(var a,t=l.page.current,n=["<a class='btn active' _index='"+t+"' func='off'>"+(t+1)+"</a>"],i=1;n.length<l.page.buttom_btn_nums&&(a=!1,t-i>=0&&(n=["<a class='btn' _index='"+(t-i)+"'>"+(t-i+1)+"</a>"].concat(n),a=!0),n.length!=l.page.buttom_btn_nums)&&(t+i<l.page.total_page&&(n.push("<a class='btn' _index='"+(t+i)+"'>"+(t+i+1)+"</a>"),a=!0),a);)i++;r.page.find("[func='c_page']").html(n.join("")),e.event.page()};0==a?r.page.find("a").each(function(){var a=jQuery(this),e=a.attr("_index");l.total<=l.page.page_size||"first"==e||"pre"==e?a.addClass("disabled").attr("func","off"):a.removeClass("disabled").removeAttr("func")}):a==t?r.page.find("a").each(function(){var a=jQuery(this),e=a.attr("_index");"next"==e||"last"==e?a.addClass("disabled").attr("func","off"):a.removeClass("disabled").removeAttr("func")}):r.page.find("a").each(function(){var a=jQuery(this),e=a.attr("_index");e==l.page.current?a.addClass("disabled").attr("func","off"):a.removeClass("disabled").removeAttr("func")}),n()},set_page:function(){var a,t=[],n=l.async&&!l.total?"":"<a class='btn' _index='first'>首页</a>",i=l.async&&!l.total?"":"<a class='btn' _index='last'>尾页</a>";if(!l.page.show)return!1;l.page.input&&(i+="<input type='text' class='c_list_input' func='goto_input' />"+(l.total?" / "+l.page.total_page:"")+"<a class='btn' _index='goto'>跳转</a>"),l.page_size=l.page.page_size,t.push("							<div class='c_list_page' func='c_list_page'>								"+n+"								<a class='btn' _index='pre'>上一页</a>								<span func='c_page'>									<a class='btn' _index='0'>1</a>						 "),a=l.page.buttom_btn_nums>l.page.total_page?l.page.total_page:l.page.buttom_btn_nums;for(var o=1;a>o;o++)t.push("<a class='btn' _index='"+o+"'>"+(o+1)+"</a>");t.push("								</span>									<a class='btn' _index='next'>下一页</a>									"+i+"							</div>"),r.self.find("[func='c_list_page']").remove(),r.page=jQuery(t.join("")),r.page.addClass(l.theme),r.self.append(r.page),l.page.show||e.event.page()}},init:function(){e.data.check(),l.replace?(r.ul=r.self,r.ul.addClass("c_list").attr("func","c_ul")):(r.ul=jQuery("<"+l.tag.ul+" class='c_list' func='c_ul'>"),r.self.html(r.ul)),l.page.show&&(e.ui.set_page(),e.ui.page()),r.self.css("overflow-y","auto"),e.ui.draw_row(l.page.load_all),l.async?window.setTimeout(function(){l.data(e.data.data())},10):e.ui.display(),e.event.init()}},t={node:function(a){return a=a||"last","first"===a?n.all["0"]:"last"===a?n.all[n.all.length-1]:"number"==typeof a?n.all[a-1]||n.all[n.all.length-1]:void 0},data:function(a,t){return arguments.length?(l.async&&l.data(e.data.data(a,t)),void 0):n.all},total:function(t){var n;return t=parseInt(t),void 0===t||"number"!=typeof t?!1:(l.total=t,l.page.show&&(n=l.page.current,l.page=e.data.page(a.page||{}),l.page.current=n,e.ui.set_page(),e.ui.page()),void 0)},sort:function(t){return a&&"function"==typeof t?(e.data.sort(t),void 0):!1},refresh:function(){l.page.show&&(e.ui.set_page(),e.ui.page()),e.ui.draw_row(l.page.load_all),l.async?window.setTimeout(function(){l.data(e.data.data())},10):e.ui.display(),e.event.init()},append:function(a,t){return a&&jQuery.isArray(a)?(e.data.append(a,void 0!==t?t:l.async?!1:!0),void 0):!1}},e.init(),t};